
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ ªå¼ç®¡ç†ãƒ„ãƒ¼ãƒ«</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button, label, select, datalist { margin: 5px; }
    .table-wrapper {
      overflow-x: auto;
      margin-top: 20px;
    }
    table { border-collapse: collapse; min-width: 800px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; cursor: pointer; }
    .profit { color: green; }
    .loss { color: red; }
  </style>
</head>
<body>

<h3>æ ªå¼ç®¡ç†ãƒ„ãƒ¼ãƒ«</h3>
<div>
  <input list="codeList" type="text" id="code" placeholder="éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ (ä¾‹: 7203.T)" oninput="validateCode(this)">
  <datalist id="codeList"></datalist>
  <input list="amountList" type="number" id="amount" placeholder="ä¿æœ‰æ•°" min="1">
  <datalist id="amountList">
    <script>
      for (let i = 100; i <= 2000; i += 100) {
        document.write(`<option value="${i}">`);
      }
    </script>
  </datalist>
  <input type="number" id="price" placeholder="å–å¾—å˜ä¾¡ (å††)">
  <button onclick="addStock()">è¿½åŠ </button>
  <br><br>
  <input type="text" id="search" placeholder="ğŸ” éŠ˜æŸ„æ¤œç´¢" oninput="renderStocks()">
  <br><br>
  <button onclick="exportCSV()">ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
  <input type="file" id="csvFile" accept=".csv" onchange="importCSV(event)">
  <label for="csvFile">ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</label>
</div>

<hr>

<h3>ä¿æœ‰éŠ˜æŸ„ä¸€è¦§</h3>
<div class="table-wrapper">
  <div id="stockList"></div>
</div>
<div id="summary"></div>

<!-- doGet()ã®çµæœã‚’1æ—¥1å›æ‰‹å‹•ã§è²¼ã‚Šä»˜ã‘ã‚‹JSONãƒ‡ãƒ¼ã‚¿ -->
<script id="stock-data-json" type="application/json">
{
  "7203.T": {
    "name": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",
    "dividend": 60,
    "shareholderBenefits": "ã‚ã‚Š",
    "price": 3200
  },
  "9984.T": {
    "name": "ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯G",
    "dividend": 0,
    "shareholderBenefits": "ãªã—",
    "price": 7800
  }
}
</script>

<script>
let currentSortKey = "";
let currentSortOrder = "asc";
let stockDataCache = null;

function validateCode(input) {
  input.value = input.value.toUpperCase().replace(/[^A-Z0-9.]/g, "");
}

function fetchStockData() {
  try {
    const rawJson = document.getElementById("stock-data-json").textContent;
    stockDataCache = JSON.parse(rawJson);
    const datalist = document.getElementById("codeList");
    datalist.innerHTML = "";
    for (const code in stockDataCache) {
      const name = stockDataCache[code].name || "";
      const option = document.createElement("option");
      option.value = code;
      option.text = `${code} - ${name}`;
      datalist.appendChild(option);
    }
  } catch (e) {
    alert("åŸ‹ã‚è¾¼ã¿æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
  }
}

function addStock() {
  const code = document.getElementById("code").value.trim().toUpperCase();
  const amount = parseInt(document.getElementById("amount").value);
  const price = parseFloat(document.getElementById("price").value);

  if (!code || isNaN(amount) || isNaN(price)) {
    alert("æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  if (!stockDataCache[code]) {
    alert("éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚");
    return;
  }

  const stockList = JSON.parse(localStorage.getItem("myStockList") || "[]");
  stockList.push({ code, amount, price });
  localStorage.setItem("myStockList", JSON.stringify(stockList));

  document.getElementById("code").value = "";
  document.getElementById("amount").value = "";
  document.getElementById("price").value = "";

  renderStocks();
}

fetchStockData();
</script>
</body>
</html>
